<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sapper</title>
    <script src="create_table.js"></script>
    <link rel="stylesheet" href="sapper.css">
</head>
<body>
    <div id="start-window">
        <p id="start-message">Welcome, sapper! We need your help... Choose your skills and get started.</p>
        <ul id="start-list">
            <li class="start-list-item">
                <a href="#!" class="level" data-column="8" data-row="8" data-mine="10">Young sapper (8x8)</a>
            </li>

            <li class="start-list-item">
                <a href="#!" class="level" data-column="15" data-row="15" data-mine="40">Experienced sapper (15x15)</a>
            </li>

            <li class="start-list-item">
                <a href="#!" class="level" data-column="30" data-row="20" data-mine="100">Professional sapper (20x30)</a>
            </li>

            <li class="start-list-item">
                <a href="#!" id="start-btn">Start</a>
            </li>
        </ul>
    </div>
    <div id="game-filed" hidden>
        <div id="timer">30:00</div>
        <div id="container"></div>
    </div>
    <script>
        let container = document.getElementById('container');
        let levels = document.getElementsByClassName('level');
        let startBtn = document.getElementById('start-btn');
        let startWindow = document.getElementById('start-window');
        let gameFiled = document.getElementById('game-filed');
        let timer = document.getElementById('timer');

        for (let level of levels) {
            level.addEventListener('click', function(){
                
                for (let level of levels) {
                    level.dataset.picked = false;
                }
                this.dataset.picked = true;
            });
        }

        startBtn.addEventListener('click', function(){
            for (let level of levels) {
                if (level.dataset.picked == 'true'){
                    createTable(level.dataset.column, level.dataset.row, level.dataset.mine, container);
                    startWindow.style.display = 'none';
                    gameFiled.classList.add('field');
                    startTimer(timer);
                }
            }
        });

        function startTimer(timer) {
            let table = document.querySelector('#container table');
            let time = timer.innerHTML.split(':');
            let minites = +time[0];
            let seconds = +time[1];
            
            let interv = setInterval(() => {
                
                if (seconds == 0 && minites != 0) {
                    minites--;
                    seconds = 59;
                } 
                else if (seconds == 0 && minites == 0 || table.dataset.win != undefined) {
                    clearInterval(interv);
                } else {
                    seconds--;
                }
                
                timer.innerHTML = addZero(minites) + ':' + addZero(seconds);
            }, 1000);
        }
        function addZero(num) {
            let length = num.toString().length;

            if (length == 1) {
                return num = '0' + num; 
            } 
            return num;
        }
    </script>
</body>
</html>
